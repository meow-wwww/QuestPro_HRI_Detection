using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using Oculus.Movement.BodyTrackingForFitness;
using System.IO;
// using Oculus.Movement.Utils;
// using Oculus.Interaction.Body.PoseDetection;


public class PoseDataCollection : MonoBehaviour
{
    public BodyPoseController bodyPoseController;
    // public GameObject ball;

    string fileName = "";
    string filePath = "";

    // Start is called before the first frame update
    void Start()
    {
        fileName = "Pose_" + System.DateTime.Now.ToString("yyyyMMddHHmmssfff") + ".csv";
        filePath = Path.Combine(Application.persistentDataPath, fileName);
        string poseNameCollection = "time,Root_Meta_x,Root_Meta_y,Root_Meta_z,Hips_Meta_x,Hips_Meta_y,Hips_Meta_z,Spine_Lower_Meta_x,Spine_Lower_Meta_y,Spine_Lower_Meta_z,Spine_Middle_Meta_x,Spine_Middle_Meta_y,Spine_Middle_Meta_z,Spine_Upper_Meta_x,Spine_Upper_Meta_y,Spine_Upper_Meta_z,Chest_Meta_x,Chest_Meta_y,Chest_Meta_z,Neck_Meta_x,Neck_Meta_y,Neck_Meta_z,Head_Meta_x,Head_Meta_y,Head_Meta_z,Left_Shoulder_Meta_x,Left_Shoulder_Meta_y,Left_Shoulder_Meta_z,Left_Scapula_Meta_x,Left_Scapula_Meta_y,Left_Scapula_Meta_z,Left_Arm_Upper_Meta_x,Left_Arm_Upper_Meta_y,Left_Arm_Upper_Meta_z,Left_Arm_Lower_Meta_x,Left_Arm_Lower_Meta_y,Left_Arm_Lower_Meta_z,Left_Hand_Wrist_Twist_Meta_x,Left_Hand_Wrist_Twist_Meta_y,Left_Hand_Wrist_Twist_Meta_z,Right_Shoulder_Meta_x,Right_Shoulder_Meta_y,Right_Shoulder_Meta_z,Right_Scapula_Meta_x,Right_Scapula_Meta_y,Right_Scapula_Meta_z,Right_Arm_Upper_Meta_x,Right_Arm_Upper_Meta_y,Right_Arm_Upper_Meta_z,Right_Arm_Lower_Meta_x,Right_Arm_Lower_Meta_y,Right_Arm_Lower_Meta_z,Right_Hand_Wrist_Twist_Meta_x,Right_Hand_Wrist_Twist_Meta_y,Right_Hand_Wrist_Twist_Meta_z,Left_Hand_Palm_Meta_x,Left_Hand_Palm_Meta_y,Left_Hand_Palm_Meta_z,Left_Hand_Wrist_Meta_x,Left_Hand_Wrist_Meta_y,Left_Hand_Wrist_Meta_z,Left_Hand_Thumb_Metacarpal_Meta_x,Left_Hand_Thumb_Metacarpal_Meta_y,Left_Hand_Thumb_Metacarpal_Meta_z,Left_Hand_Thumb_Proximal_Meta_x,Left_Hand_Thumb_Proximal_Meta_y,Left_Hand_Thumb_Proximal_Meta_z,Left_Hand_Thumb_Distal_Meta_x,Left_Hand_Thumb_Distal_Meta_y,Left_Hand_Thumb_Distal_Meta_z,Left_Hand_Thumb_Tip_Meta_x,Left_Hand_Thumb_Tip_Meta_y,Left_Hand_Thumb_Tip_Meta_z,Left_Hand_Index_Metacarpal_Meta_x,Left_Hand_Index_Metacarpal_Meta_y,Left_Hand_Index_Metacarpal_Meta_z,Left_Hand_Index_Proximal_Meta_x,Left_Hand_Index_Proximal_Meta_y,Left_Hand_Index_Proximal_Meta_z,Left_Hand_Index_Intermediate_Meta_x,Left_Hand_Index_Intermediate_Meta_y,Left_Hand_Index_Intermediate_Meta_z,Left_Hand_Index_Distal_Meta_x,Left_Hand_Index_Distal_Meta_y,Left_Hand_Index_Distal_Meta_z,Left_Hand_Index_Tip_Meta_x,Left_Hand_Index_Tip_Meta_y,Left_Hand_Index_Tip_Meta_z,Left_Hand_Middle_Metacarpal_Meta_x,Left_Hand_Middle_Metacarpal_Meta_y,Left_Hand_Middle_Metacarpal_Meta_z,Left_Hand_Middle_Proximal_Meta_x,Left_Hand_Middle_Proximal_Meta_y,Left_Hand_Middle_Proximal_Meta_z,Left_Hand_Middle_Intermediate_Meta_x,Left_Hand_Middle_Intermediate_Meta_y,Left_Hand_Middle_Intermediate_Meta_z,Left_Hand_Middle_Distal_Meta_x,Left_Hand_Middle_Distal_Meta_y,Left_Hand_Middle_Distal_Meta_z,Left_Hand_Middle_Tip_Meta_x,Left_Hand_Middle_Tip_Meta_y,Left_Hand_Middle_Tip_Meta_z,Left_Hand_Ring_Metacarpal_Meta_x,Left_Hand_Ring_Metacarpal_Meta_y,Left_Hand_Ring_Metacarpal_Meta_z,Left_Hand_Ring_Proximal_Meta_x,Left_Hand_Ring_Proximal_Meta_y,Left_Hand_Ring_Proximal_Meta_z,Left_Hand_Ring_Intermediate_Meta_x,Left_Hand_Ring_Intermediate_Meta_y,Left_Hand_Ring_Intermediate_Meta_z,Left_Hand_Ring_Distal_Meta_x,Left_Hand_Ring_Distal_Meta_y,Left_Hand_Ring_Distal_Meta_z,Left_Hand_Ring_Tip_Meta_x,Left_Hand_Ring_Tip_Meta_y,Left_Hand_Ring_Tip_Meta_z,Left_Hand_Little_Metacarpal_Meta_x,Left_Hand_Little_Metacarpal_Meta_y,Left_Hand_Little_Metacarpal_Meta_z,Left_Hand_Little_Proximal_Meta_x,Left_Hand_Little_Proximal_Meta_y,Left_Hand_Little_Proximal_Meta_z,Left_Hand_Little_Intermediate_Meta_x,Left_Hand_Little_Intermediate_Meta_y,Left_Hand_Little_Intermediate_Meta_z,Left_Hand_Little_Distal_Meta_x,Left_Hand_Little_Distal_Meta_y,Left_Hand_Little_Distal_Meta_z,Left_Hand_Little_Tip_Meta_x,Left_Hand_Little_Tip_Meta_y,Left_Hand_Little_Tip_Meta_z,Right_Hand_Palm_Meta_x,Right_Hand_Palm_Meta_y,Right_Hand_Palm_Meta_z,Right_Hand_Wrist_Meta_x,Right_Hand_Wrist_Meta_y,Right_Hand_Wrist_Meta_z,Right_Hand_Thumb_Metacarpal_Meta_x,Right_Hand_Thumb_Metacarpal_Meta_y,Right_Hand_Thumb_Metacarpal_Meta_z,Right_Hand_Thumb_Proximal_Meta_x,Right_Hand_Thumb_Proximal_Meta_y,Right_Hand_Thumb_Proximal_Meta_z,Right_Hand_Thumb_Distal_Meta_x,Right_Hand_Thumb_Distal_Meta_y,Right_Hand_Thumb_Distal_Meta_z,Right_Hand_Thumb_Tip_Meta_x,Right_Hand_Thumb_Tip_Meta_y,Right_Hand_Thumb_Tip_Meta_z,Right_Hand_Index_Metacarpal_Meta_x,Right_Hand_Index_Metacarpal_Meta_y,Right_Hand_Index_Metacarpal_Meta_z,Right_Hand_Index_Proximal_Meta_x,Right_Hand_Index_Proximal_Meta_y,Right_Hand_Index_Proximal_Meta_z,Right_Hand_Index_Intermediate_Meta_x,Right_Hand_Index_Intermediate_Meta_y,Right_Hand_Index_Intermediate_Meta_z,Right_Hand_Index_Distal_Meta_x,Right_Hand_Index_Distal_Meta_y,Right_Hand_Index_Distal_Meta_z,Right_Hand_Index_Tip_Meta_x,Right_Hand_Index_Tip_Meta_y,Right_Hand_Index_Tip_Meta_z,Right_Hand_Middle_Metacarpal_Meta_x,Right_Hand_Middle_Metacarpal_Meta_y,Right_Hand_Middle_Metacarpal_Meta_z,Right_Hand_Middle_Proximal_Meta_x,Right_Hand_Middle_Proximal_Meta_y,Right_Hand_Middle_Proximal_Meta_z,Right_Hand_Middle_Intermediate_Meta_x,Right_Hand_Middle_Intermediate_Meta_y,Right_Hand_Middle_Intermediate_Meta_z,Right_Hand_Middle_Distal_Meta_x,Right_Hand_Middle_Distal_Meta_y,Right_Hand_Middle_Distal_Meta_z,Right_Hand_Middle_Tip_Meta_x,Right_Hand_Middle_Tip_Meta_y,Right_Hand_Middle_Tip_Meta_z,Right_Hand_Ring_Metacarpal_Meta_x,Right_Hand_Ring_Metacarpal_Meta_y,Right_Hand_Ring_Metacarpal_Meta_z,Right_Hand_Ring_Proximal_Meta_x,Right_Hand_Ring_Proximal_Meta_y,Right_Hand_Ring_Proximal_Meta_z,Right_Hand_Ring_Intermediate_Meta_x,Right_Hand_Ring_Intermediate_Meta_y,Right_Hand_Ring_Intermediate_Meta_z,Right_Hand_Ring_Distal_Meta_x,Right_Hand_Ring_Distal_Meta_y,Right_Hand_Ring_Distal_Meta_z,Right_Hand_Ring_Tip_Meta_x,Right_Hand_Ring_Tip_Meta_y,Right_Hand_Ring_Tip_Meta_z,Right_Hand_Little_Metacarpal_Meta_x,Right_Hand_Little_Metacarpal_Meta_y,Right_Hand_Little_Metacarpal_Meta_z,Right_Hand_Little_Proximal_Meta_x,Right_Hand_Little_Proximal_Meta_y,Right_Hand_Little_Proximal_Meta_z,Right_Hand_Little_Intermediate_Meta_x,Right_Hand_Little_Intermediate_Meta_y,Right_Hand_Little_Intermediate_Meta_z,Right_Hand_Little_Distal_Meta_x,Right_Hand_Little_Distal_Meta_y,Right_Hand_Little_Distal_Meta_z,Right_Hand_Little_Tip_Meta_x,Right_Hand_Little_Tip_Meta_y,Right_Hand_Little_Tip_Meta_z,Left_Upper_Leg_Meta_x,Left_Upper_Leg_Meta_y,Left_Upper_Leg_Meta_z,Left_Lower_Leg_Meta_x,Left_Lower_Leg_Meta_y,Left_Lower_Leg_Meta_z,Left_Foot_Ankle_Twist_Meta_x,Left_Foot_Ankle_Twist_Meta_y,Left_Foot_Ankle_Twist_Meta_z,Left_Foot_Ankle_Meta_x,Left_Foot_Ankle_Meta_y,Left_Foot_Ankle_Meta_z,Left_Foot_Subtalar_Meta_x,Left_Foot_Subtalar_Meta_y,Left_Foot_Subtalar_Meta_z,Left_Foot_Transverse_Meta_x,Left_Foot_Transverse_Meta_y,Left_Foot_Transverse_Meta_z,Left_Foot_Ball_Meta_x,Left_Foot_Ball_Meta_y,Left_Foot_Ball_Meta_z,Right_Upper_Leg_Meta_x,Right_Upper_Leg_Meta_y,Right_Upper_Leg_Meta_z,Right_Lower_Leg_Meta_x,Right_Lower_Leg_Meta_y,Right_Lower_Leg_Meta_z,Right_Foot_Ankle_Twist_Meta_x,Right_Foot_Ankle_Twist_Meta_y,Right_Foot_Ankle_Twist_Meta_z,Right_Foot_Ankle_Meta_x,Right_Foot_Ankle_Meta_y,Right_Foot_Ankle_Meta_z,Right_Foot_Subtalar_Meta_x,Right_Foot_Subtalar_Meta_y,Right_Foot_Subtalar_Meta_z,Right_Foot_Transverse_Meta_x,Right_Foot_Transverse_Meta_y,Right_Foot_Transverse_Meta_z,Right_Foot_Ball_Meta_x,Right_Foot_Ball_Meta_y,Right_Foot_Ball_Meta_z";
        File.WriteAllText(filePath, poseNameCollection + "\n");
    }

    // Update is called once per frame
    void Update()
    {
        // Debug.Log("Current Pose: " + bodyPoseController.BonePoses[54].position);
        // if (ball != null) ball.transform.position = bodyPoseController.BonePoses[54].position;

        // Debug.Log("BonePoses List Len: " + bodyPoseController.BonePoses.Count);
        string poseValueCollection = "";
        for (int i = 0; i < 84; i++){
            poseValueCollection += bodyPoseController.BonePoses[i].position.x + "," + bodyPoseController.BonePoses[i].position.y + "," + bodyPoseController.BonePoses[i].position.z + ",";
        }
        poseValueCollection = poseValueCollection.TrimEnd(',');
        File.AppendAllText(filePath, System.DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss.fff") + "," + poseValueCollection + "\n");
    }
}
